<!doctype html><meta charset=utf-8><title>S</title><script src="http://is.gd/dS08d"></script><style>body{background-color:#ccc;}ul{width:350px;overflow:hidden;margin:0 auto;padding:20px;}li{position:relative;list-style:none;width:40px;height:40px;float:left;margin:5px;background-color:#fff;-webkit-box-shadow:0 1px 0px rgba(255,255,255,1);-moz-box-shadow:0 1px 0px rgba(0,0,0,.1);-ms-box-shadow:0 1px 0px rgba(0,0,0,.1);-webkit-border-radius:5px;-moz-border-radius:5px;background-color:#999;}li.d{background-color:#bbb;}b{position:absolute;display:block;width:40px;height:45px;top:-4px;-webkit-border-radius:5px;-webkit-box-shadow:inset 0 -5px 0px rgba(0,0,0,.5), inset 0 2px 0px rgba(255,255,255,.1), 0 4px 0px rgba(0,0,0,.2);background-image:-webkit-gradient(linear, 0% 0%, 0% 100%, from(rgba(0,0,0,0)), to(rgba(0,0,0,.15)));}.c1{background-color:red;}.c2{background-color:blue;}.c3{background-color:green;}.c4{background-color:purple;}.c5{background-color:yellow;}b.s{-webkit-box-shadow:inset 0 -5px 0px rgba(0,0,0,.5), inset 0 2px 0px rgba(255,255,255,.1), 0 4px 0px rgba(0,0,0,.2), 0 0 20px #fff, 0 0 20px #fff,  0 0 20px #fff;}</style><ul id="c"></ul><script>S=new Class({brd:[],sl:false,row:4,initialize:function(){var t=this,E=Element;t.c=$('c');for(var x=0;x<7;x++){t.brd[x]=[];for(var y=0;y<7;y++)t.brd[x][y]={c:0,e:new E('li').inject(t.c).addEvent('click',t.clk.bind(this,[x,y])),p:null,a:false}}t.cps()},cps:function(){var t=this,r=$random;var a=[r(1,5),r(1,5),r(1,5)];for(var x=0;x<3;x++){var b=t.ga();if(b.length===0)return t.eg();b=b[r(0,b.length-1)];b=t.brd[b[0]][b[1]];b.c=a[x];b.p=new Element('b',{'class':'c'+a[x]}).inject(b.e)}},ga:function(){var t=this;var a=[];for(var x=0;x<7;x++)for(var y=0;y<7;y++)if(t.brd[x][y].c===0)a[a.length]=[x,y];return a},eg:function(){alert('Game is over')},clk:function(x,y){var t=this;if(t.brd[x][y].c>0)return t.sp(x,y);if(t.sl!==false)return t.mvp(x,y)},mvp:function(x,y){var t=this,cr=t.brd[t.sl[0]][t.sl[1]],nw=t.brd[x][y];if(nw.a===false)return;cr.p.inject(nw.e).removeClass('s');nw.p=cr.p;nw.c=cr.c;cr.p=null;cr.c=0;cr.a=false;t.sl=false;t.sar();t.rc(x,y)},sp:function(x,y){var t=this;if(t.sl!==false)t.brd[t.sl[0]][t.sl[1]].p.removeClass('s');t.brd[x][y].p.addClass('s');t.sl=[x,y];t.sa(x,y)},sa:function(c,d){var t=this,b=t.brd;t.sar(true);var e=0;var m=function(a,b){if(a.length===0)return;var x=a[0][0],y=a[0][1];a.splice(0,1);if(f(x-1,y))a[a.length]=[x-1,y];if(f(x+1,y))a[a.length]=[x+1,y];if(f(x,y-1))a[a.length]=[x,y-1];if(f(x,y+1))a[a.length]=[x,y+1];return m(a)};var f=function(x,y){if(x<0||x>=7||y<0||y>=7||b[x][y].a===true||b[x][y].c>0)return false;b[x][y].a=true;b[x][y].e.removeClass('d');return true};m([[c,d]])},sar:function(d){var t=this;for(var x=0;x<7;x++)for(var y=0;y<7;y++){t.brd[x][y].a=false;if(d)t.brd[x][y].e.addClass('d');else t.brd[x][y].e.removeClass('d')}},rc:function(c,d){var t=this,b=t.brd,fr=[],lc=0,pcs=[],rct=0;var e=function(x,y){if(x===0||y===0)return[x,y];if(x>y)x=x-y,y=0;else y=y-x,x=0;return[x,y]};var f=function(x,y){if(x===0||y===6)return[x,y];var a=6-y;if(a<=x)y+=a,x-=a;else y+=x,x=0;return[x,y]};var g=function(){fr.extend(pcs);lc=0;pcs=[];rct++};var h=function(x,y){var a=b[x][y];if(a.c===0){if(pcs.length>=t.row)g();return lc=0,pcs=[]}if(a.c!==lc){if(pcs.length>=t.row)g();return lc=a.c,pcs=[[x,y]]}pcs[pcs.length]=[x,y]};for(var y=0;y<7;y++)h(c,y);if(pcs.length>=t.row)g();for(var x=0;x<7;x++)h(x,d);if(pcs.length>=t.row)g();var i=e(c,d);for(var x=0;x<7;x++){if(i[0]>=7||i[1]>=7)break;h(i[0],i[1]);i[0]++;i[1]++}if(pcs.length>=t.row)g();var j=f(c,d);for(var x=0;x<7;x++){if(j[0]>=7||j[1]<0)break;h(j[0],j[1]);j[0]++;j[1]--}if(pcs.length>=t.row)g();if(rct===0)t.cps();else t.rm(fr)},rm:function(c){var t=this;c.each(function(a){var b=t.brd[a[0]][a[1]];if(b.c===0)return;b.p.destroy();b.p=null;b.c=0},this)}});new S();</script>